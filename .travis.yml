sudo: required

services:
  - docker

language: java
jdk: oraclejdk8

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

after_success:
  - bash <(curl -s https://codecov.io/bash)

  - docker --version
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS



  - export PATH=$PATH:$HOME/.local/bin
  - export PROJECT=peavers

  # TAG
#  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
  - export TAG=latest

  # EDGE SERVICE
  - export CONFIG=$PROJECT/edge-service
  - docker build -t $CONFIG ./edge-service
  - docker tag $CONFIG:$TAG $CONFIG:$TAG
  - docker push $CONFIG

#  # INSTANCE SERVICE
#  - export CONFIG=$PROJECT/instance-service
#  - docker build -t $CONFIG ./instance-service
#  - docker tag $CONFIG:$TAG $CONFIG:$TAG
#  - docker push $CONFIG:$TAG
#
#  # NODE SERVICE
#  - export CONFIG=$PROJECT/node-service
#  - docker build -t $CONFIG ./node-service
#  - docker tag $CONFIG:$TAG $CONFIG:$TAG
#  - docker push $CONFIG:$TAG
#
#  # NOTIFICATION SERVICE
#  - export CONFIG=$PROJECT/notification-service
#  - docker build -t $CONFIG ./notification-service
#  - docker tag $CONFIG:$TAG $CONFIG:$TAG
#  - docker push $CONFIG:$TAG
#
#  # RESTORE SERVICE
#  - export CONFIG=$PROJECT/restore-service
#  - docker build -t $CONFIG ./restore-service
#  - docker tag $CONFIG:$TAG $CONFIG:$TAG
#  - docker push $CONFIG:$TAG